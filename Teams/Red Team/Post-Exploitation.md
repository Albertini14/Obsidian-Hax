# Enumeration
- [[Powerview]]
- [[Bloodhound]]
- [[Mimikatz]]

## [[Post Enum - Linux|Linux Enumeration]]
| Linux Command     | Description                                    |
| ----------------- | ---------------------------------------------- |
| `hostname`        | shows the system’s hostname                    |
| `who`             | shows who is logged in                         |
| `whoami`          | shows the effective username                   |
| `w`               | shows who is logged in and what they are doing |
| `last`            | shows a listing of the last logged-in users    |
| `ip address show` | shows the network interfaces and addresses     |
| `arp`             | shows the ARP cache                            |
| `netstat`         | prints network connections                     |
| `ps`              | shows a snapshot of the current processes      |

## [[Post Enum - Windows|Windows Enumeration]]

| Windows Command  | Description                                                                              |
| ---------------- | ---------------------------------------------------------------------------------------- |
| `systeminfo`     | shows OS configuration information, including service pack levels                        |
| `whoami`         | shows the user name and group information along with the respective security identifiers |
| `netstat`        | shows protocol statistics and current TCP/IP network connections                         |
| `net user`       | shows the user accounts on the computer                                                  |
| `net localgroup` | shows the local groups on the computer                                                   |
| `arp`            | shows the IP-to-Physical address translation tables                                      |

## [[Host Evasion#Host Security Solutions|Host Evasion]]
Before performing any actions, we need to obtain a general knowledge about the security solutions in place. It is important to enumerate Antivirus (AV) and security detection methods on an endpoint in order to stay as undetected as possible and reduce the chance of getting caught. 

## Applications and Services
### Installed Applications
We can use the `wmic` command to list all installed applications and their version
```powershell
wmic product get name,version
```
Another thing to look for particular are text strings, hidden directories, backup files. For this we can use `Get-ChildItem`
```powershell
Get-ChildItem -Hidden -Path C:\Users\user\Desktop
```

### Services and Process
Windows services enable the system administrator to create long-running executable applications in our own Windows sessions. Sometimes Windows services have misconfiguration permissions, which escalates the current user access level of permissions. 
We can list running services using 
```powershell
net start
```
From here we can see a service which we want to know more about, and look for the exact service name, which we need to find more information
```powershell
wmic service where "name like 'Important Service'" get Name,PathName
```
Once we find the file name and it's path, we can get more info using 
```powershell
Get-Process -Name important_service
```

### Sharing files and Printers
Sharing files and network resources is commonly used in personal and enterprise environments. System administrators misconfigure access permissions, and they may have useful information about other accounts and systems.

### Internal services: DNS, local web applications, etc.
Internal [[Network Services Vulnerabilities|network services]] are another source of information to expand our knowledge about other systems and the entire environment.

Using the PID of a service, we can check if its providing a network service by listing the listening the ports within the system
```powershell
netstat -noa | findstr "LISTENING" | findstr PID
```

We can also perform DNS zone transfer using 
```powershell
nslookup.exe
```
Once within the app we provide the DNS server that we need to ask, in this case the target machine
```
server IP
```
Now we can try the DNS zone transfer on a domain we found in the AD environment
```
ls -d activedirectorydomain.com
```

## Network Enumeration
There are various things to check related to networking aspects such as TCP and UDP ports and established connections, routing tables, ARP tables, etc.

### TCP and UDP ports
We can check the target machine's upen ports with the `netstat` command. This output reveals the open ports as well as the established connections.
### ARP table
ARP tables are the ones that contain the IP address and the MAC address of the computers that communicated with the target machines within the network. This could be helpful to see the communications within the network to scan the other machines for open ports and vulnerabilities. For this we use `arp -a`.
### [[Active Directory#Enumeration|Active Directory]]
In order to check whether the machine is part of the AD environment or not, we can user the `systeminfo` command, providing us information about the machine, including the OS name and version, hostname and other hardware information as well as the AD domain
```cmd
systeminfo | findstr Domain
```
If we get `WORKGROUP` in the domain section, then it means that this machine is part of a local workgroup.

## Network Infrastructure
Once we arrive to an unknown network our first goal is to identify where we are and what we can get to. For this we need to understand what target system we are dealing with, what services the machine provides and what kind of network we are in.

### Internal Networks
Internal Networks are subnetworks that are segmented and separated based on the importance of the internal device or the importance of the accessibility of its data. The main purpose of the internal network is to share information, faster and easier communications, collaboration tools , and network services within an organization.
In a corporate network, the network administrators intend to use network segmentation for various reasons, including controlling network traffic, optimizing network performance, and improving security posture.

### Demilitarized Zone (DMZ)
A DMZ network is an edge network that protects and adds an extra security layer to a corporation's internal local-area network from untrusted traffic. A common design for DMZ is a subnetwork that sits between the public internet and internal networks.
A company for example may design a DMZ network to isolate and enable access control on the public network traffic, and untrusted traffic.

## [[Network Evasion]]
Network security solutions could be software or hardware appliances used to monitor, detect and prevent malicious activities within the network. It focuses on protecting clients and devices connected to the cooperation network.

# [[Persistence]]
There are a few ways to maintain access on a machine or network. Such as the persistence Metasploit module, allowing us to create a backdoor service in the system that will give us an instant meterpreter shell if the machine is ever shutdown or reset.
Other ways may be advanced backdoors and rootkits.

To do this we need to get a meterpreter session in the target machine. Once obtained, we `use exploit/windows/local/persistence`, this module will send a payload every 10 seconds in default, however we can set this time to anything we want. 
Now if the system is shut down we will lose our meterpreter session, but by using the persistence module we create a backdoor which we can access at any time using the `multi/handler`